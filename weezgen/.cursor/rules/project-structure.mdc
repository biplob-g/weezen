# Project Structure & Organization

## ğŸ“ **Directory Structure**

```
weezgen/
â”œâ”€â”€ .cursor/
â”‚   â””â”€â”€ rules/                    # Project documentation and patterns
â”‚       â”œâ”€â”€ weezgen-overview.mdc
â”‚       â”œâ”€â”€ database-patterns.mdc
â”‚       â”œâ”€â”€ component-patterns.mdc
â”‚       â”œâ”€â”€ project-structure.mdc
â”‚       â””â”€â”€ user-info-form-feature.mdc
â”œâ”€â”€ actions/                      # Server Actions (API endpoints)
â”‚   â”œâ”€â”€ appointments/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â””â”€â”€ index.ts              # AI chatbot and conversation management
â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â””â”€â”€ index.ts              # Customer and chat room management
â”‚   â”œâ”€â”€ mailer/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ app/                          # Next.js App Router pages
â”‚   â”œâ”€â”€ (dashboard)/              # Protected admin routes
â”‚   â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # Conversation management page
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # Dashboard layout
â”‚   â”‚   â”œâ”€â”€ page.tsx              # Dashboard home
â”‚   â”‚   â”œâ”€â”€ portal/               # Customer portal
â”‚   â”‚   â”‚   â”œâ”€â”€ [domainid]/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ appointments/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [customerid]/
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ payments/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ [customerid]/
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ settings/             # Domain settings
â”‚   â”‚       â”œâ”€â”€ [domain]/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ api/                      # API routes
â”‚   â”‚   â””â”€â”€ test-chatbot/
â”‚   â”œâ”€â”€ auth/                     # Authentication pages
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ sign-in/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ sign-up/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ chatbot/
â”‚   â”‚   â””â”€â”€ page.tsx              # Public chatbot page
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ globals.css               # Global styles
â”‚   â”œâ”€â”€ layout.tsx                # Root layout
â”‚   â””â”€â”€ page.tsx                  # Landing page
â”œâ”€â”€ components/                   # React components
â”‚   â”œâ”€â”€ accordion/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ chatbot/                  # Chatbot interface components
â”‚   â”‚   â”œâ”€â”€ bubble.tsx            # Individual message bubbles
â”‚   â”‚   â”œâ”€â”€ index.tsx             # Main chatbot entry point
â”‚   â”‚   â”œâ”€â”€ realtime.tsx          # Real-time chat functionality
â”‚   â”‚   â”œâ”€â”€ responding.tsx        # AI typing indicator
â”‚   â”‚   â”œâ”€â”€ window.tsx            # Chatbot window with conditional rendering
â”‚   â”‚   â”œâ”€â”€ UserInfoForm.tsx      # â­ NEW: User information collection form
â”‚   â”‚   â””â”€â”€ ChatHistory.tsx       # â­ NEW: Previous conversations display
â”‚   â”œâ”€â”€ conversations/            # Admin conversation management
â”‚   â”‚   â”œâ”€â”€ chatCard.tsx          # Individual conversation cards with delete
â”‚   â”‚   â”œâ”€â”€ index.tsx             # Main conversation list with filtering
â”‚   â”‚   â”œâ”€â”€ messenger.tsx         # Chat interface for admin
â”‚   â”‚   â””â”€â”€ search.tsx            # Domain selection and search
â”‚   â”œâ”€â”€ drawer/
â”‚   â”‚   â””â”€â”€ AppDrawer.tsx
â”‚   â”œâ”€â”€ forms/                    # Form components
â”‚   â”‚   â”œâ”€â”€ portal/               # Customer portal forms
â”‚   â”‚   â”‚   â”œâ”€â”€ portalForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PortalSteps.tsx
â”‚   â”‚   â”‚   â””â”€â”€ QuestionsForm.tsx
â”‚   â”‚   â”œâ”€â”€ SignIn/               # Authentication forms
â”‚   â”‚   â”‚   â”œâ”€â”€ formProvider.tsx
â”‚   â”‚   â”‚   â””â”€â”€ loginForm.tsx
â”‚   â”‚   â””â”€â”€ SignUp/               # Registration forms
â”‚   â”‚       â”œâ”€â”€ accountDetailsForm.tsx
â”‚   â”‚       â”œâ”€â”€ buttonHandler.tsx
â”‚   â”‚       â”œâ”€â”€ formGenerator/
â”‚   â”‚       â”‚   â””â”€â”€ index.tsx
â”‚   â”‚       â”œâ”€â”€ formProvider.tsx
â”‚   â”‚       â”œâ”€â”€ highlightsBar.tsx
â”‚   â”‚       â”œâ”€â”€ otpForm.tsx
â”‚   â”‚       â”œâ”€â”€ registrationStep.tsx
â”‚   â”‚       â”œâ”€â”€ settings/
â”‚   â”‚       â”‚   â”œâ”€â”€ CodeSnippet.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ DomainUpdate.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ EditChatbotIcon.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚       â”‚   â””â”€â”€ greetingsMessage.tsx
â”‚   â”‚       â”œâ”€â”€ typeSeletionForm.tsx
â”‚   â”‚       â””â”€â”€ userTypeCard.tsx
â”‚   â”œâ”€â”€ Header/
â”‚   â”‚   â””â”€â”€ Header.tsx
â”‚   â”œâ”€â”€ infoBar/
â”‚   â”‚   â”œâ”€â”€ BreadCrumb.tsx
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ loader/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ otp/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ portal/
â”‚   â”‚   â””â”€â”€ banner.tsx
â”‚   â”œâ”€â”€ provider/
â”‚   â”‚   â””â”€â”€ theme-provider.tsx
â”‚   â”œâ”€â”€ SectionLabel/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ settings/                 # Settings components
â”‚   â”‚   â”œâ”€â”€ BillingSettings.tsx
â”‚   â”‚   â”œâ”€â”€ BotTrainingForm.tsx
â”‚   â”‚   â”œâ”€â”€ ChangePassword.tsx
â”‚   â”‚   â”œâ”€â”€ DarkModeToggle.tsx
â”‚   â”‚   â”œâ”€â”€ FilterQuestions.tsx
â”‚   â”‚   â””â”€â”€ HelpDesk.tsx
â”‚   â”œâ”€â”€ Sidebar/                  # Navigation sidebar
â”‚   â”‚   â”œâ”€â”€ domainMenu.tsx
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ maximizedMenu.tsx
â”‚   â”‚   â”œâ”€â”€ menuItems.tsx
â”‚   â”‚   â”œâ”€â”€ minimizedmenu.tsx
â”‚   â”‚   â””â”€â”€ useSidebar.tsx
â”‚   â”œâ”€â”€ spinner/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ tabs/
â”‚   â”‚   â””â”€â”€ index.tsx
â”‚   â”œâ”€â”€ themes-placeholder/
â”‚   â”‚   â”œâ”€â”€ darkmode.tsx
â”‚   â”‚   â”œâ”€â”€ lightmode.tsx
â”‚   â”‚   â””â”€â”€ systemMode.tsx
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui components
â”‚   â”‚   â”œâ”€â”€ accordion.tsx
â”‚   â”‚   â”œâ”€â”€ alert-dialog.tsx
â”‚   â”‚   â”œâ”€â”€ alert.tsx
â”‚   â”‚   â”œâ”€â”€ aspect-ratio.tsx
â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ breadcrumb.tsx
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ calendar.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ carousel.tsx
â”‚   â”‚   â”œâ”€â”€ chart.tsx
â”‚   â”‚   â”œâ”€â”€ checkbox.tsx
â”‚   â”‚   â”œâ”€â”€ collapsible.tsx
â”‚   â”‚   â”œâ”€â”€ command.tsx
â”‚   â”‚   â”œâ”€â”€ context-menu.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ drawer.tsx
â”‚   â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”œâ”€â”€ hover-card.tsx
â”‚   â”‚   â”œâ”€â”€ input-otp.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”œâ”€â”€ menubar.tsx
â”‚   â”‚   â”œâ”€â”€ navigation-menu.tsx
â”‚   â”‚   â”œâ”€â”€ pagination.tsx
â”‚   â”‚   â”œâ”€â”€ popover.tsx
â”‚   â”‚   â”œâ”€â”€ progress.tsx
â”‚   â”‚   â”œâ”€â”€ radio-group.tsx
â”‚   â”‚   â”œâ”€â”€ resizable.tsx
â”‚   â”‚   â”œâ”€â”€ scroll-area.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”œâ”€â”€ separator.tsx
â”‚   â”‚   â”œâ”€â”€ sheet.tsx
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ skeleton.tsx
â”‚   â”‚   â”œâ”€â”€ slider.tsx
â”‚   â”‚   â”œâ”€â”€ sonner.tsx
â”‚   â”‚   â”œâ”€â”€ switch.tsx
â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”œâ”€â”€ tabs.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”œâ”€â”€ toggle-group.tsx
â”‚   â”‚   â”œâ”€â”€ toggle.tsx
â”‚   â”‚   â””â”€â”€ tooltip.tsx
â”‚   â””â”€â”€ uploadButton/
â”‚       â””â”€â”€ index.tsx
â”œâ”€â”€ components.json               # shadcn/ui configuration
â”œâ”€â”€ constants/                    # Application constants
â”‚   â”œâ”€â”€ forms.ts                  # Form field configurations
â”‚   â””â”€â”€ menu.tsx                  # Menu structure
â”œâ”€â”€ context/                      # React Context providers
â”‚   â”œâ”€â”€ useAuthContext.tsx        # Authentication context
â”‚   â””â”€â”€ useChatContext.tsx        # Chat context
â”œâ”€â”€ hooks/                        # Custom React hooks
â”‚   â”œâ”€â”€ chatbot/
â”‚   â”‚   â”œâ”€â”€ useChatBot.ts         # Main chatbot logic
â”‚   â”‚   â””â”€â”€ useCurrentDomain.ts   # Current domain management
â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â””â”€â”€ useConversation.ts    # Conversation management
â”‚   â”œâ”€â”€ portal/
â”‚   â”‚   â””â”€â”€ usePortal.ts          # Portal functionality
â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ useSettings.ts        # Settings management
â”‚   â”œâ”€â”€ sidebar/
â”‚   â”‚   â””â”€â”€ useDomain.ts          # Domain management
â”‚   â”œâ”€â”€ sign-in/
â”‚   â”‚   â””â”€â”€ useSignIn.ts          # Sign-in functionality
â”‚   â”œâ”€â”€ sign-up/
â”‚   â”‚   â””â”€â”€ useSignUp.ts          # Sign-up functionality
â”‚   â””â”€â”€ use-mobile.ts             # Mobile detection
â”œâ”€â”€ icons/                        # Custom icons
â”œâ”€â”€ lib/                          # Utility libraries
â”‚   â”œâ”€â”€ generated/                # Generated files
â”‚   â”œâ”€â”€ prisma.ts                 # Prisma client configuration
â”‚   â”œâ”€â”€ utils.ts                  # Utility functions
â”‚   â”œâ”€â”€ countryCodes.ts           # â­ NEW: Country codes and IP detection
â”‚   â””â”€â”€ ipUtils.ts                # â­ NEW: IP address utilities
â”œâ”€â”€ middleware.ts                 # Next.js middleware
â”œâ”€â”€ middleware.txt                # Middleware documentation
â”œâ”€â”€ next.config.ts                # Next.js configuration
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json                  # Dependencies and scripts
â”œâ”€â”€ postcss.config.mjs            # PostCSS configuration
â”œâ”€â”€ prisma/                       # Database schema and migrations
â”‚   â””â”€â”€ schema.prisma             # Database schema definition
â”œâ”€â”€ public/                       # Static assets
â”‚   â”œâ”€â”€ file.svg
â”‚   â”œâ”€â”€ globe.svg
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ app-ui.png
â”‚   â”‚   â”œâ”€â”€ bouncing-circles.svg
â”‚   â”‚   â””â”€â”€ globe.svg
â”‚   â”œâ”€â”€ next.svg
â”‚   â”œâ”€â”€ vercel.svg
â”‚   â””â”€â”€ window.svg
â”œâ”€â”€ README.md                     # Project documentation
â”œâ”€â”€ schemas/                      # Zod validation schemas
â”‚   â”œâ”€â”€ auth.schema.ts            # Authentication schemas
â”‚   â”œâ”€â”€ coversation.schema.ts     # Conversation and form schemas
â”‚   â””â”€â”€ settings.schema.ts        # Settings schemas
â”œâ”€â”€ scripts/                      # â­ NEW: Database maintenance scripts
â”‚   â”œâ”€â”€ cleanup-old-customers.ts  # Clean up old customer records
â”‚   â”œâ”€â”€ test-ip-detection.ts      # Test IP detection functionality
â”‚   â”œâ”€â”€ update-existing-customers.ts # Update existing customers with IPs
â”‚   â””â”€â”€ cleanup-all-data.ts       # Complete data cleanup for testing
â”œâ”€â”€ tailwind.config.js            # Tailwind CSS configuration
â””â”€â”€ tsconfig.json                 # TypeScript configuration
```

## ğŸ”§ **Key File Descriptions**

### **Core Application Files**

#### **Configuration Files**

- **`next.config.ts`**: Next.js configuration with optimizations
- **`tailwind.config.js`**: Tailwind CSS configuration with custom theme
- **`tsconfig.json`**: TypeScript configuration with strict settings
- **`components.json`**: shadcn/ui component configuration
- **`package.json`**: Dependencies, scripts, and project metadata

#### **Database & Schema**

- **`prisma/schema.prisma`**: Database schema with Customer, ChatRoom, ChatMessage models
- **`lib/prisma.ts`**: Prisma client configuration and connection
- **`schemas/`**: Zod validation schemas for type safety

### **New Feature Files** â­

#### **User Information Form Feature**

- **`components/chatbot/UserInfoForm.tsx`**: Form component for collecting user details
- **`components/chatbot/ChatHistory.tsx`**: Component for displaying previous conversations
- **`lib/countryCodes.ts`**: Country codes data and IP-based country detection
- **`lib/ipUtils.ts`**: IP address validation and utility functions

#### **Database Maintenance Scripts**

- **`scripts/cleanup-old-customers.ts`**: Remove customer records older than 14 days
- **`scripts/test-ip-detection.ts`**: Test IP detection and customer data
- **`scripts/update-existing-customers.ts`**: Update existing customers with IP addresses
- **`scripts/cleanup-all-data.ts`**: Complete data cleanup for testing

### **Component Organization**

#### **Chatbot Components** (`components/chatbot/`)

- **`index.tsx`**: Main entry point for chatbot functionality
- **`window.tsx`**: Chatbot window with conditional rendering (form/history/chat)
- **`bubble.tsx`**: Individual message bubbles with error handling
- **`UserInfoForm.tsx`**: User information collection with country detection
- **`ChatHistory.tsx`**: Previous conversations display for returning users
- **`responding.tsx`**: AI typing indicator
- **`realtime.tsx`**: Real-time chat functionality

#### **Conversation Management** (`components/conversations/`)

- **`index.tsx`**: Main conversation list with filtering (All/Unread/Expired)
- **`chatCard.tsx`**: Individual conversation cards with delete functionality
- **`messenger.tsx`**: Chat interface for admin panel
- **`search.tsx`**: Domain selection and search functionality

#### **Form Components** (`components/forms/`)

- **`SignUp/`**: Multi-step registration process
- **`SignIn/`**: Authentication forms with error handling
- **`portal/`**: Customer portal forms and steps

### **Custom Hooks** (`hooks/`)

#### **Chatbot Hooks**

- **`useChatBot.ts`**: Main chatbot logic with IP-based user detection
- **`useCurrentDomain.ts`**: Current domain management

#### **Conversation Hooks**

- **`useConversation.ts`**: Conversation management with filtering and real-time updates

#### **Authentication Hooks**

- **`useSignIn.ts`**: Sign-in functionality with Clerk integration
- **`useSignUp.ts`**: Sign-up process management

### **Server Actions** (`actions/`)

#### **Bot Actions** (`actions/bot/`)

- **`index.ts`**: AI chatbot responses and conversation storage

#### **Conversation Actions** (`actions/conversation/`)

- **`index.ts`**: Customer management, IP-based detection, chat room operations

#### **Authentication Actions** (`actions/auth/`)

- **`index.ts`**: User authentication and authorization

## ğŸ¯ **File Naming Conventions**

### **Component Files**

- **PascalCase**: `UserInfoForm.tsx`, `ChatHistory.tsx`
- **Descriptive names**: Clear indication of component purpose
- **Index files**: `index.tsx` for main component exports

### **Hook Files**

- **camelCase with 'use' prefix**: `useChatBot.ts`, `useConversation.ts`
- **Feature-specific**: Organized by feature area

### **Utility Files**

- **camelCase**: `ipUtils.ts`, `countryCodes.ts`
- **Descriptive**: Clear indication of functionality

### **Schema Files**

- **camelCase**: `coversation.schema.ts`, `auth.schema.ts`
- **Feature-based**: Organized by data domain

## ğŸ”„ **Import Organization**

### **Import Order**

```typescript
// 1. React and Next.js imports
import React, { useState, useEffect } from "react";
import { useRouter } from "next/navigation";

// 2. Third-party libraries
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

// 3. Internal utilities and configurations
import { cn } from "@/lib/utils";
import { client } from "@/lib/prisma";

// 4. Server actions
import { onCreateCustomerWithInfo } from "@/actions/conversation";

// 5. Schemas and types
import {
  UserInfoFormSchema,
  UserInfoFormProps,
} from "@/schemas/coversation.schema";

// 6. UI components
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";

// 7. Custom hooks
import { useChatBot } from "@/hooks/chatbot/useChatBot";
```

### **Path Aliases**

- **`@/`**: Points to project root
- **`@/components/`**: React components
- **`@/hooks/`**: Custom hooks
- **`@/lib/`**: Utility libraries
- **`@/actions/`**: Server actions
- **`@/schemas/`**: Validation schemas

## ğŸ“¦ **Module Organization**

### **Feature-Based Organization**

- **Chatbot**: All chatbot-related components, hooks, and actions
- **Conversations**: Admin conversation management
- **Authentication**: Sign-in/sign-up functionality
- **Settings**: Domain and application settings

### **Shared Components**

- **`components/ui/`**: Reusable UI components (shadcn/ui)
- **`components/forms/`**: Form components and patterns
- **`lib/`**: Utility functions and configurations

## ğŸš€ **Development Workflow**

### **Adding New Features**

1. **Create components** in appropriate feature directory
2. **Add custom hooks** for business logic
3. **Create server actions** for backend operations
4. **Define schemas** for type safety
5. **Update documentation** in `.cursor/rules/`

### **Database Changes**

1. **Update schema** in `prisma/schema.prisma`
2. **Generate client**: `npx prisma generate`
3. **Push changes**: `npx prisma db push`
4. **Update actions** to use new schema
5. **Add migration scripts** if needed

### **Component Development**

1. **Create component** with TypeScript interface
2. **Add form validation** with Zod schemas
3. **Implement error handling** with try-catch blocks
4. **Add loading states** for better UX
5. **Test with different data scenarios**

## ğŸ” **File Search Patterns**

### **Finding Components**

```bash
# Find all chatbot components
find components/chatbot -name "*.tsx"

# Find all form components
find components/forms -name "*.tsx"

# Find all custom hooks
find hooks -name "*.ts"
```

### **Finding Server Actions**

```bash
# Find all server actions
find actions -name "*.ts"

# Find specific action types
find actions -name "*conversation*"
```

### **Finding Schemas**

```bash
# Find all schema files
find schemas -name "*.ts"

# Find specific schema types
find schemas -name "*auth*"
```

## ğŸ“‹ **Maintenance Tasks**

### **Regular Cleanup**

- **Database**: Run `scripts/cleanup-old-customers.ts` periodically
- **Dependencies**: Update packages with `npm update`
- **TypeScript**: Check for type errors with `npm run type-check`
- **Linting**: Run `npm run lint` for code quality

### **Testing Scripts**

- **IP Detection**: Test with `scripts/test-ip-detection.ts`
- **Data Cleanup**: Use `scripts/cleanup-all-data.ts` for testing
- **Customer Updates**: Use `scripts/update-existing-customers.ts` for migration

### **Documentation Updates**

- **Update rules**: Keep `.cursor/rules/` files current
- **README**: Update project documentation
- **Comments**: Maintain inline code documentation
